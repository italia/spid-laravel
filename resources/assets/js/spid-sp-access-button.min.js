window.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.italia-it-button').forEach(italia_btn => {
        italia_btn.addEventListener('click', e => {
            e.preventDefault();

            let spid_idp_m_post = italia_btn.closest('form').querySelector('[id^="' + italia_btn.getAttribute('spid-idp-button').substring(1) + '"]');
            italia_btn.classList.toggle('spid-idp-button-open');

            if (italia_btn.classList.contains('spid-idp-button-open')) {
                spid_idp_m_post.style.display = 'block';
                let x = italia_btn.offsetLeft;
                let width = italia_btn.clientWidth;

                spid_idp_m_post.style.left = x.toString() + 'px';
                spid_idp_m_post.style.minWidth = width.toString() + 'px';
            } else {
                spid_idp_m_post.style.display = 'none';
            }
        });
    });
});

window.addEventListener('click', e => {
    document.querySelectorAll('.spid-idp-button-open').forEach(italia_btn => {
        let spid_idp_m_post = italia_btn.closest('form').querySelector('[id^="' + italia_btn.getAttribute('spid-idp-button').substring(1) + '"]');
        if (!italia_btn.closest('form').contains(e.target)) {
            italia_btn.classList.remove('spid-idp-button-open');
            spid_idp_m_post.style.display = 'none';
        }
    });
});
